name: Lint and test
on: [push]
env:
  PYTHONPATH: .
jobs:
  lint_and_test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-python@v2
      id: setup-python
      with:
        python-version: "3.9"
    - name: Setup Mamba
      uses: mamba-org/setup-micromamba@v1
      with:
        # micromamba-version: '1.3.1-0'
        environment-file: envs/environment.yaml
        cache-environment: true
        post-cleanup: 'all'
    - run: pip install pre-commit
    - name: Cache Pre-commit for format checking
      uses: actions/cache@v3
      with:
        path: ~/.cache/pre-commit
        key: pre-commit-3|${{ hashFiles('.pre-commit-config.yaml') }}
    - name: Check formatting
      run: pre-commit run --all-files --show-diff-on-failure
      shell: micromamba-shell {0}
    - run: pytest
      shell: micromamba-shell {0}
